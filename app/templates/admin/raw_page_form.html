{% extends "base.html" %}
{% block title %}{{ '編輯頁面' if page else '新增頁面' }}{% endblock %}
{% block extra_css %}
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
  .ql-editor {
    min-height: 300px;
    max-height: 400px;
    overflow-y: auto;
  }
  .form-container {
    max-width: 900px;
    margin: 0 auto;
  }
  .editor-container {
    margin-bottom: 20px;
  }
  .form-actions {
    position: sticky;
    bottom: 0;
    background: white;
    padding: 15px 0;
    border-top: 1px solid #dee2e6;
    margin-top: 20px;
  }
</style>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    var quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline', 'strike'],
          ['blockquote', 'code-block'],
          [{ 'header': 1 }, { 'header': 2 }],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          [{ 'script': 'sub'}, { 'script': 'super' }],
          [{ 'indent': '-1'}, { 'indent': '+1' }],
          [{ 'direction': 'rtl' }],
          [{ 'size': ['small', false, 'large', 'huge'] }],
          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
          [{ 'color': [] }, { 'background': [] }],
          [{ 'font': [] }],
          [{ 'align': [] }],
          ['clean'],
          ['link', 'image', 'video']
        ]
      },
      placeholder: '開始撰寫內容...'
    });

    // 同步 Quill 內容到隱藏的 textarea
    var form = document.querySelector('form');
    form.addEventListener('submit', function() {
      var content = document.querySelector('input[name="content"]');
      content.value = quill.root.innerHTML;
    });

    // 如果有現有內容，載入到編輯器
    {% if page and page.content %}
    quill.root.innerHTML = `{{ page.content | safe }}`;
    {% endif %}
  });
</script>
{% endblock %}
{% block content %}
<div class="container py-3">
  <div class="card form-container">
    <div class="card-header">
      <h4 class="mb-0">{{ '編輯頁面' if page else '新增頁面' }}</h4>
    </div>
    <div class="card-body">
      <form method="post">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">類型</label>
            <select name="type" class="form-select" required>
              <option value="">請選擇類型</option>
              {% for t in page_types %}
                <option value="{{ t.name }}" {% if page and page.type == t %}selected{% endif %}>
                  {% if t.name == 'ABOUT' %}關於我們
                  {% elif t.name == 'TERMS' %}服務條款
                  {% elif t.name == 'PRIVACY' %}隱私政策
                  {% elif t.name == 'FAQ' %}常見問題
                  {% elif t.name == 'CONTACT' %}聯絡我們
                  {% elif t.name == 'CUSTOM' %}自訂頁面
                  {% else %}{{ t.value }}{% endif %}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-8">
            <label class="form-label">標題</label>
            <input class="form-control" name="title" value="{{ page.title if page }}" required />
          </div>
          <div class="col-12">
            <label class="form-label">圖片URL</label>
            <input class="form-control" name="image" value="{{ page.image if page }}" placeholder="https://example.com/image.jpg" />
          </div>
          <div class="col-12">
            <label class="form-label">內容</label>
            <div class="editor-container">
              <div id="editor"></div>
            </div>
            <input type="hidden" name="content" value="{{ page.content if page }}" />
            <div class="form-text">支援富文本編輯，可插入圖片、連結、表格等</div>
          </div>
        </div>
        <div class="form-actions">
          <div class="d-flex gap-2">
            <button class="btn btn-primary" type="submit">
              <i class="bi bi-save"></i> 儲存
            </button>
            <a href="{{ url_for('admin_raw_pages') }}" class="btn btn-secondary">
              <i class="bi bi-arrow-left"></i> 返回
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}